language: node_js
node_js:
  - 16

services:
  - docker

variables:
  DOCKER_USERNAME: $DOCKER_USERNAME
  DOCKER_PASSWORD: $DOCKER_PASSWORD
  API_FEED_VERSION: $API_FEED_VERSION
  API_USER_VERSION: $API_USER_VERSION
  FRONTEND_VERSION: $FRONTEND_VERSION
  REVERSEPROXY_VERSION: $REVERSEPROXY_VERSION

script:
  # Print docker version
    - docker --version
  # Build
    - docker build -t udagram-api-feed ./udagram-api-feed
    - docker build -t udagram-api-user ./udagram-api-user
    - docker build -t udagram-frontend ./udagram-frontend
    - docker build -t udagram-reverseproxy ./udagram-reverseproxy
  # Tagging
    - docker tag udagram-api-feed $DOCKER_USERNAME/udagram-api-feed:$API_FEED_VERSION
    - docker tag udagram-api-user $DOCKER_USERNAME/udagram-api-user:$API_USER_VERSION
    - docker tag udagram-frontend $DOCKER_USERNAME/udagram-frontend:$FRONTEND_VERSION
    - docker tag udagram-reverseproxy $DOCKER_USERNAME/udagram-reverseproxy:$REVERSEPROXY_VERSION
  # Push
    - echo "$DOCKER_PASSWORD" | docker login -u "$DOCKER_USERNAME" --password-stdin
    - docker push $DOCKER_USERNAME/udagram-api-feed:$API_FEED_VERSION
    - docker push $DOCKER_USERNAME/udagram-api-user:$API_USER_VERSION
    - docker push $DOCKER_USERNAME/udagram-frontend:$FRONTEND_VERSION
    - docker push $DOCKER_USERNAME/udagram-reverseproxy:$REVERSEPROXY_VERSION
